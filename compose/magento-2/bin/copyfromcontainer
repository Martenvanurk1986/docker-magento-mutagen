#!/bin/bash
set -e

## change into directory one level above where this script is located allowing it to be run from anywhere
cd "$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null && pwd )/.."

## Load per-project configuration variables
if [[ -f "env/_config" ]]; then
    source env/_config
fi

CONTAINER_SRC_SYNC_DIR=${CONTAINER_SRC_SYNC_DIR:-src}

[ -z "$1" ] && echo "Please specify a directory or file to copy from container (ex. vendor, --all)" && exit

if [ "$1" == "--all" ]; then
  docker cp $(docker-compose ps -q phpfpm|awk '{print $1}'):/var/www/html/./ ${CONTAINER_SRC_SYNC_DIR}/
  echo "Completed copying all files from container to host"
else
  docker cp $(docker-compose ps -q phpfpm|awk '{print $1}'):/var/www/html/$1 ${CONTAINER_SRC_SYNC_DIR}/
  echo "Completed copying $1 from container to host"
fi
